@startuml
'/' Updated after adding requirements.txt
class Main
class MetaboCycle
class GoalManager {
  -goal_path : Path
  -reflection_path : Path
  +get_goal()
  +set_goal(goal)
  +load_reflection()
  +save_reflection(text)
}
class MemoryManager {
  +graph : IntentionGraph
  +metabo_graph : MetaboGraph
  -emotion_log : Path
  -reflection_path : Path
  -entropy_path : Path
  +store_triplets(triplets)
  +add_metabo_insight_to_graph(user_input, triplets, goal, reflection, emotion)
  +store_reflection(reflection)
  +load_reflection()
  +save_emotion(ent_before, ent_after)
  +calculate_entropy()
  +load_last_entropy()
  +store_last_entropy(value)
  +map_entropy_to_emotion(delta)
}
class IntentionGraph {
  +filepath : str
  +goal_path : Path
  +graph : MultiDiGraph
  +goal_graph : DiGraph
  +load_graph()
  +save_graph()
  +add_triplets(triplets)
  +snapshot()
  +add_goal_transition(previous_goal, new_goal)
  +get_goal_path()
  +visualize_graph(output_path)
}
class ReflectionEngine
class TaktEngine
class YinYangOrchestrator {
  +mode
  -_override : str
  -_deltas : List[float]
  -_history : List[str]
  -_heartbeat : int
  -_next_beat : datetime
  +set_mode(mode)
  +decide_mode(metrics, text, sub_done)
  +_contains_uncertainty(text)
}
class ModeDecider {
  +decide_yin_yang_mode(text, metrics)
}
class MetaboGUI
class GraphViewer {
  +draw()
  +_on_zoom()
  +_on_drag_start()
  +_on_drag_move()
}
class GraphEntropyScorer {
  +calculate_entropy(graph)
  +explain_entropy(graph)
}
class MetaboGraph {
  +filepath : Path
  +graph : MultiDiGraph
  +add_graph(graph)
  +add_triplets(triplets)
  +import_intention_graph(path)
  +calculate_entropy()
  +snapshot()
  +save()
  -_load()
  -_merge_node(node, typ, source)
}
class GraphManager {
  +intention_graph : IntentionGraph
  +metabo_graph : MetaboGraph
  +add_triplets(triplets, node_typ, edge_typ, source)
  +save_graph()
  +snapshot()
}
class MetaboLogger {
  +filepath : Path
  +log_cycle(input_text, reflection, triplets, ent_before, ent_after, emotion, intensity)
}

Main --> MetaboCycle
MetaboCycle --> GoalManager
MetaboCycle --> MemoryManager
MetaboCycle --> ReflectionEngine
ReflectionEngine --> GraphManager
MetaboCycle --> YinYangOrchestrator
MetaboCycle --> ModeDecider
MemoryManager --> IntentionGraph
MemoryManager --> MetaboGraph
TaktEngine --> MemoryManager
TaktEngine --> GoalManager
TaktEngine --> ReflectionEngine
Main --> YinYangOrchestrator
MetaboGUI --> MetaboCycle : uses thread
MetaboGUI --> TaktEngine : uses thread
MetaboGUI --> GraphViewer
MemoryManager --> GraphEntropyScorer
GraphViewer --> MetaboGraph
MetaboCycle --> MetaboLogger
@enduml
