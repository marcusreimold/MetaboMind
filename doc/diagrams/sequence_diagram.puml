@startuml
'/ updated after emotion-mode fix
actor User
participant MetaboGUI
participant MetaboCycle
participant GoalManager
participant MemoryManager
participant ReflectionEngine
participant YinYangOrchestrator
participant ModeDecider
participant GraphViewer
participant GraphEntropyScorer
User -> GraphViewer: drag/zoom
User -> MetaboGUI: input text
MetaboGUI -> MetaboCycle: run_metabo_cycle(text) ##thread##
MetaboCycle -> GoalManager: get_goal()
MetaboCycle -> MemoryManager: snapshot()
MetaboCycle -> GraphEntropyScorer: calculate_entropy()
GraphEntropyScorer --> MetaboCycle: score
MetaboCycle -> ReflectionEngine: generate_reflection(mode_hint)
MetaboCycle -> MemoryManager: add_metabo_insight_to_graph()
MemoryManager -> MetaboGraph: add_triplets()
MetaboGraph -> MetaboGraph: save()
MetaboCycle -> MemoryManager: save_emotion()
MetaboCycle -> YinYangOrchestrator: decide_mode(metrics)
MetaboCycle -> ModeDecider: decide_yin_yang_mode(metrics)
ModeDecider --> MetaboCycle: mode
YinYangOrchestrator -> YinYangOrchestrator: debug_print()
MetaboCycle --> MetaboGUI: result
MetaboGUI -> GraphViewer: draw
@enduml
